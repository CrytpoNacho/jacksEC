generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model detalle_pedido_ec {
  id          Int        @id @default(autoincrement())
  id_pedido   Int
  id_producto String     
  cantidad    Int
  precio      Decimal    
  subtotal    Decimal?   
  pedidos_ec  pedidos_ec @relation(fields: [id_pedido], references: [id], onUpdate: NoAction)
}

model facturacion_ec {
  id          Int          @id @default(autoincrement())
  id_pedido   Int
  total       Decimal      
  fecha       DateTime?    @default(now())
  estado      String       
  pedidos_ec  pedidos_ec   @relation(fields: [id_pedido], references: [id], onUpdate: NoAction)
}

model pedidos_ec {
  id          Int                   @id @default(autoincrement())
  id_usuario  Int
  fecha       DateTime?              @default(now())
  estado      String  
  id_factura  Int?
  detalle_pedido_ec detalle_pedido_ec[]
  facturacion_ec facturacion_ec? @relation(fields: [id_factura], references: [id], onDelete: NoAction, onUpdate: NoAction)
  usuarios_ecommerce usuarios_ecommerce  @relation(fields: [id_usuario], references: [id], onUpdate: NoAction)
}

model usuarios_ecommerce {
  id                   Int       @id @default(autoincrement())
  codigo_empleado      String    @unique
  nombre               String    
  correo               String    @unique
  telefono             String?   
  direccion            String?   
  fecha_registro       DateTime? @default(now())
  estado               String?   @default("Activo")
  cedula               String    
  notificaciones_push  Boolean?  @default(true)
  notificaciones_email Boolean?  @default(true)
  rol                  String    @default("comprador")
  carrito_ec           carrito_ec[]
  historial_compras_ec historial_compras_ec[]
  pedidos_ec           pedidos_ec[]
}

model productos_ec {
  Id                  Int      @id @default(autoincrement())
  CodArticulo         String   
  NomArticulo         String   
  Precio              Decimal  
  PrecioImpuesto      Decimal  
  image_url           String?  
  CodCabys            String   
  stock               Int
  categorias          String?  
  carrito_ec          carrito_ec[]
  productos_comprados productos_comprados[]
}

model carrito_ec {
  id                 Int                @id @default(autoincrement())
  id_usuario         Int
  id_producto        Int
  cantidad           Int
  fecha_agregado     DateTime?          @default(now())
  productos_ec       productos_ec       @relation(fields: [id_producto], references: [Id], onUpdate: NoAction)
  usuarios_ecommerce usuarios_ecommerce @relation(fields: [id_usuario], references: [id], onUpdate: NoAction)
}

model historial_compras_ec {
  id                  Int      @id @default(autoincrement())
  id_usuario          Int
  transaction_id      String   @default(gen_random_uuid()) 
  invoice             String  
  fecha_hora          DateTime?  @default(now())
  device              String?  
  location            String?  
  total               Decimal  
  estado              String   
  metodo_pago         String   @default("Deducci√≥n de Planilla")
  factura_url         String?  
  usuarios_ecommerce  usuarios_ecommerce @relation(fields: [id_usuario], references: [id], onUpdate: NoAction)
  productos_comprados productos_comprados[]
}

model productos_comprados {
  id                   Int      @id @default(autoincrement())
  id_historial         Int
  id_producto          Int
  cantidad             Int      @default(1)
  historial_compras_ec historial_compras_ec @relation(fields: [id_historial], references: [id], onDelete: Cascade, onUpdate: NoAction)
  productos_ec         productos_ec @relation(fields: [id_producto], references: [Id], onDelete: Cascade, onUpdate: NoAction)
}
